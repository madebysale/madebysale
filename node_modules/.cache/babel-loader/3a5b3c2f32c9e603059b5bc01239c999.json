{"ast":null,"code":"import _regeneratorRuntime from \"/home/iss/Downloads/POS_ADMIN_2/POS_ADMIN1/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"/home/iss/Downloads/POS_ADMIN_2/POS_ADMIN1/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _slicedToArray from \"/home/iss/Downloads/POS_ADMIN_2/POS_ADMIN1/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";\nimport _objectSpread from \"/home/iss/Downloads/POS_ADMIN_2/POS_ADMIN1/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\n\nvar _jsxFileName = \"/home/iss/Downloads/POS_ADMIN_2/POS_ADMIN1/src/app/contexts/JWTAuthContext.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport React, { createContext, useEffect, useReducer } from 'react';\nimport jwtDecode from 'jwt-decode';\nimport axios from 'axios.js';\nimport { MatxLoading } from 'app/components';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar initialState = {\n  isAuthenticated: false,\n  isInitialised: false,\n  user: null\n};\n\nvar isValidToken = function isValidToken(accessToken) {\n  if (!accessToken) {\n    return false;\n  }\n\n  var decodedToken = jwtDecode(accessToken);\n  var currentTime = Date.now() / 1000;\n  return decodedToken.exp > currentTime;\n};\n\nvar setSession = function setSession(accessToken) {\n  if (accessToken) {\n    localStorage.setItem('accessToken', accessToken);\n    axios.defaults.headers.common['x-token'] = \"\".concat(accessToken);\n  } else {\n    localStorage.removeItem('accessToken');\n    delete axios.defaults.headers.common['x-token'];\n  }\n};\n\nvar reducer = function reducer(state, action) {\n  switch (action.type) {\n    case 'INIT':\n      {\n        var _action$payload = action.payload,\n            isAuthenticated = _action$payload.isAuthenticated,\n            user = _action$payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: isAuthenticated,\n          isInitialised: true,\n          user: user\n        });\n      }\n\n    case 'LOGIN':\n      {\n        var _user = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user\n        });\n      }\n\n    case 'LOGOUT':\n      {\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: false,\n          user: null\n        });\n      }\n\n    case 'REGISTER':\n      {\n        var _user2 = action.payload.user;\n        return _objectSpread(_objectSpread({}, state), {}, {\n          isAuthenticated: true,\n          user: _user2\n        });\n      }\n\n    default:\n      {\n        return _objectSpread({}, state);\n      }\n  }\n};\n\nvar AuthContext = /*#__PURE__*/createContext(_objectSpread(_objectSpread({}, initialState), {}, {\n  method: 'JWT',\n  login: function login() {\n    return Promise.resolve();\n  },\n  logout: function logout() {},\n  register: function register() {\n    return Promise.resolve();\n  }\n}));\nexport var AuthProvider = function AuthProvider(_ref) {\n  _s();\n\n  var children = _ref.children;\n\n  var _useReducer = useReducer(reducer, initialState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      state = _useReducer2[0],\n      dispatch = _useReducer2[1];\n\n  var login = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(email, password) {\n      var response, _response$data$data, accessToken, user;\n\n      return _regeneratorRuntime().wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return axios.post('http://:3000/api/public/adminposlogin', {\n                email: email,\n                password: password\n              });\n\n            case 2:\n              response = _context.sent;\n              _response$data$data = response.data.data, accessToken = _response$data$data.accessToken, user = _response$data$data.user;\n              console.log(accessToken, user, 'kamlesh rajpoot');\n              setSession(accessToken);\n              dispatch({\n                type: 'LOGIN',\n                payload: {\n                  user: user\n                }\n              });\n\n            case 7:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function login(_x, _x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var register = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(email, username, password) {\n      var response, _response$data, accessToken, user;\n\n      return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              _context2.next = 2;\n              return axios.post('/api/auth/register', {\n                email: email,\n                username: username,\n                password: password\n              });\n\n            case 2:\n              response = _context2.sent;\n              _response$data = response.data, accessToken = _response$data.accessToken, user = _response$data.user;\n              setSession(accessToken);\n              dispatch({\n                type: 'REGISTER',\n                payload: {\n                  user: user\n                }\n              });\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    }));\n\n    return function register(_x3, _x4, _x5) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var logout = function logout() {\n    setSession(null);\n    dispatch({\n      type: 'LOGOUT'\n    });\n  };\n\n  useEffect(function () {\n    ;\n\n    _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3() {\n      var accessToken, response, user;\n      return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              accessToken = window.localStorage.getItem('accessToken');\n\n              if (!accessToken) {\n                _context3.next = 11;\n                break;\n              }\n\n              setSession(accessToken); // const response = await axios.get('/api/auth/profile')\n              // const { user } = response.data\n\n              _context3.next = 6;\n              return axios.post('http://localhost:3000/api/admin/adminposdetails');\n\n            case 6:\n              response = _context3.sent;\n              user = response.data.data.user;\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: true,\n                  user: user\n                }\n              });\n              _context3.next = 12;\n              break;\n\n            case 11:\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: false,\n                  user: null\n                }\n              });\n\n            case 12:\n              _context3.next = 18;\n              break;\n\n            case 14:\n              _context3.prev = 14;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n              dispatch({\n                type: 'INIT',\n                payload: {\n                  isAuthenticated: false,\n                  user: null\n                }\n              });\n\n            case 18:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 14]]);\n    }))();\n  }, []);\n\n  if (!state.isInitialised) {\n    return /*#__PURE__*/_jsxDEV(MatxLoading, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 158,\n      columnNumber: 16\n    }, _this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: _objectSpread(_objectSpread({}, state), {}, {\n      method: 'JWT',\n      login: login,\n      logout: logout,\n      register: register\n    }),\n    children: [\" \", children, \" \"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 159,\n    columnNumber: 15\n  }, _this);\n};\n\n_s(AuthProvider, \"bgCdjuTOmPdSBRwTap80EFd9Y3U=\");\n\n_c = AuthProvider;\nexport default AuthContext;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useReducer","jwtDecode","axios","MatxLoading","initialState","isAuthenticated","isInitialised","user","isValidToken","accessToken","decodedToken","currentTime","Date","now","exp","setSession","localStorage","setItem","defaults","headers","common","removeItem","reducer","state","action","type","payload","AuthContext","method","login","Promise","resolve","logout","register","AuthProvider","children","dispatch","email","password","post","response","data","console","log","username","window","getItem","error"],"sources":["/home/iss/Downloads/POS_ADMIN_2/POS_ADMIN1/src/app/contexts/JWTAuthContext.js"],"sourcesContent":["import React, { createContext, useEffect, useReducer } from 'react'\nimport jwtDecode from 'jwt-decode'\nimport axios from 'axios.js'\nimport { MatxLoading } from 'app/components'\n\nconst initialState = {\n    isAuthenticated: false,\n    isInitialised: false,\n    user: null\n}\nconst isValidToken = (accessToken) => {\n    if (!accessToken) {\n        return false\n    }\n\n    const decodedToken = jwtDecode(accessToken)\n    const currentTime = Date.now() / 1000\n    return decodedToken.exp > currentTime\n}\nconst setSession = (accessToken) => {\n    if (accessToken) {\n        localStorage.setItem('accessToken', accessToken)\n        axios.defaults.headers.common['x-token'] = `${accessToken}`\n    } else {\n        localStorage.removeItem('accessToken')\n        delete axios.defaults.headers.common['x-token']\n    }\n}\nconst reducer = (state, action) => {\n    switch (action.type) {\n        case 'INIT':\n            {\n                const { isAuthenticated, user } = action.payload\n\n                return {\n                    ...state,\n                    isAuthenticated,\n                    isInitialised: true,\n                    user\n                }\n            }\n        case 'LOGIN':\n            {\n                const { user } = action.payload\n\n                return {\n                    ...state,\n                    isAuthenticated: true,\n                    user\n                }\n            }\n        case 'LOGOUT':\n            {\n                return {\n                    ...state,\n                    isAuthenticated: false,\n                    user: null\n                }\n            }\n        case 'REGISTER':\n            {\n                const { user } = action.payload\n\n                return {\n                    ...state,\n                    isAuthenticated: true,\n                    user\n                }\n            }\n        default:\n            {\n                return {\n                    ...state\n                }\n            }\n    }\n}\nconst AuthContext = createContext({\n    ...initialState,\n    method: 'JWT',\n    login: () => Promise.resolve(),\n    logout: () => { },\n    register: () => Promise.resolve()\n})\nexport const AuthProvider = ({ children }) => {\n    const [state, dispatch] = useReducer(reducer, initialState)\n    const login = async (email, password) => {\n        const response = await axios.post('http://:3000/api/public/adminposlogin', { email, password })\n        const { accessToken, user } = response.data.data\n        console.log(accessToken, user, 'kamlesh rajpoot')\n        setSession(accessToken)\n\n        dispatch({\n            type: 'LOGIN', payload: {\n                user\n            }\n        })\n    }\n    const register = async (email, username, password) => {\n        const response = await axios.post('/api/auth/register', { email, username, password })\n\n        const { accessToken, user } = response.data\n\n        setSession(accessToken)\n\n        dispatch({\n            type: 'REGISTER', payload: {\n                user\n            }\n        })\n    }\n    const logout = () => {\n        setSession(null)\n        dispatch({ type: 'LOGOUT' })\n    }\n    useEffect(() => {\n        ;\n        (async () => {\n            try {\n                const accessToken = window.localStorage.getItem('accessToken')\n\n                if (accessToken) {\n\n                    setSession(accessToken)\n                    // const response = await axios.get('/api/auth/profile')\n                    // const { user } = response.data\n                    const response = await axios.post('http://localhost:3000/api/admin/adminposdetails')\n                    const { user } = response.data.data\n                    dispatch({\n                        type: 'INIT',\n                        payload: {\n                            isAuthenticated: true,\n                            user\n                        }\n                    })\n                } else {\n                    dispatch({\n                        type: 'INIT',\n                        payload: {\n                            isAuthenticated: false,\n                            user: null\n                        }\n                    })\n                }\n            } catch (err) {\n                console.error(err)\n                dispatch({\n                    type: 'INIT',\n                    payload: {\n                        isAuthenticated: false,\n                        user: null\n                    }\n                })\n            }\n        })()\n    }, [])\n    if (!state.isInitialised) {\n        return <MatxLoading />\n    } return (<AuthContext.Provider value={\n        {\n            ...state,\n            method: 'JWT',\n            login,\n            logout,\n            register\n        }\n    }> {children} </AuthContext.Provider>)\n}\nexport default AuthContext\n"],"mappings":";;;;;;;;;AAAA,OAAOA,KAAP,IAAgBC,aAAhB,EAA+BC,SAA/B,EAA0CC,UAA1C,QAA4D,OAA5D;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,KAAP,MAAkB,UAAlB;AACA,SAASC,WAAT,QAA4B,gBAA5B;;AAEA,IAAMC,YAAY,GAAG;EACjBC,eAAe,EAAE,KADA;EAEjBC,aAAa,EAAE,KAFE;EAGjBC,IAAI,EAAE;AAHW,CAArB;;AAKA,IAAMC,YAAY,GAAG,SAAfA,YAAe,CAACC,WAAD,EAAiB;EAClC,IAAI,CAACA,WAAL,EAAkB;IACd,OAAO,KAAP;EACH;;EAED,IAAMC,YAAY,GAAGT,SAAS,CAACQ,WAAD,CAA9B;EACA,IAAME,WAAW,GAAGC,IAAI,CAACC,GAAL,KAAa,IAAjC;EACA,OAAOH,YAAY,CAACI,GAAb,GAAmBH,WAA1B;AACH,CARD;;AASA,IAAMI,UAAU,GAAG,SAAbA,UAAa,CAACN,WAAD,EAAiB;EAChC,IAAIA,WAAJ,EAAiB;IACbO,YAAY,CAACC,OAAb,CAAqB,aAArB,EAAoCR,WAApC;IACAP,KAAK,CAACgB,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,SAA9B,cAA8CX,WAA9C;EACH,CAHD,MAGO;IACHO,YAAY,CAACK,UAAb,CAAwB,aAAxB;IACA,OAAOnB,KAAK,CAACgB,QAAN,CAAeC,OAAf,CAAuBC,MAAvB,CAA8B,SAA9B,CAAP;EACH;AACJ,CARD;;AASA,IAAME,OAAO,GAAG,SAAVA,OAAU,CAACC,KAAD,EAAQC,MAAR,EAAmB;EAC/B,QAAQA,MAAM,CAACC,IAAf;IACI,KAAK,MAAL;MACI;QACI,sBAAkCD,MAAM,CAACE,OAAzC;QAAA,IAAQrB,eAAR,mBAAQA,eAAR;QAAA,IAAyBE,IAAzB,mBAAyBA,IAAzB;QAEA,uCACOgB,KADP;UAEIlB,eAAe,EAAfA,eAFJ;UAGIC,aAAa,EAAE,IAHnB;UAIIC,IAAI,EAAJA;QAJJ;MAMH;;IACL,KAAK,OAAL;MACI;QACI,IAAQA,KAAR,GAAiBiB,MAAM,CAACE,OAAxB,CAAQnB,IAAR;QAEA,uCACOgB,KADP;UAEIlB,eAAe,EAAE,IAFrB;UAGIE,IAAI,EAAJA;QAHJ;MAKH;;IACL,KAAK,QAAL;MACI;QACI,uCACOgB,KADP;UAEIlB,eAAe,EAAE,KAFrB;UAGIE,IAAI,EAAE;QAHV;MAKH;;IACL,KAAK,UAAL;MACI;QACI,IAAQA,MAAR,GAAiBiB,MAAM,CAACE,OAAxB,CAAQnB,IAAR;QAEA,uCACOgB,KADP;UAEIlB,eAAe,EAAE,IAFrB;UAGIE,IAAI,EAAJA;QAHJ;MAKH;;IACL;MACI;QACI,yBACOgB,KADP;MAGH;EA7CT;AA+CH,CAhDD;;AAiDA,IAAMI,WAAW,gBAAG7B,aAAa,iCAC1BM,YAD0B;EAE7BwB,MAAM,EAAE,KAFqB;EAG7BC,KAAK,EAAE;IAAA,OAAMC,OAAO,CAACC,OAAR,EAAN;EAAA,CAHsB;EAI7BC,MAAM,EAAE,kBAAM,CAAG,CAJY;EAK7BC,QAAQ,EAAE;IAAA,OAAMH,OAAO,CAACC,OAAR,EAAN;EAAA;AALmB,GAAjC;AAOA,OAAO,IAAMG,YAAY,GAAG,SAAfA,YAAe,OAAkB;EAAA;;EAAA,IAAfC,QAAe,QAAfA,QAAe;;EAC1C,kBAA0BnC,UAAU,CAACsB,OAAD,EAAUlB,YAAV,CAApC;EAAA;EAAA,IAAOmB,KAAP;EAAA,IAAca,QAAd;;EACA,IAAMP,KAAK;IAAA,uEAAG,iBAAOQ,KAAP,EAAcC,QAAd;MAAA;;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACapC,KAAK,CAACqC,IAAN,CAAW,uCAAX,EAAoD;gBAAEF,KAAK,EAALA,KAAF;gBAASC,QAAQ,EAARA;cAAT,CAApD,CADb;;YAAA;cACJE,QADI;cAAA,sBAEoBA,QAAQ,CAACC,IAAT,CAAcA,IAFlC,EAEFhC,WAFE,uBAEFA,WAFE,EAEWF,IAFX,uBAEWA,IAFX;cAGVmC,OAAO,CAACC,GAAR,CAAYlC,WAAZ,EAAyBF,IAAzB,EAA+B,iBAA/B;cACAQ,UAAU,CAACN,WAAD,CAAV;cAEA2B,QAAQ,CAAC;gBACLX,IAAI,EAAE,OADD;gBACUC,OAAO,EAAE;kBACpBnB,IAAI,EAAJA;gBADoB;cADnB,CAAD,CAAR;;YANU;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAH;;IAAA,gBAALsB,KAAK;MAAA;IAAA;EAAA,GAAX;;EAYA,IAAMI,QAAQ;IAAA,uEAAG,kBAAOI,KAAP,EAAcO,QAAd,EAAwBN,QAAxB;MAAA;;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACUpC,KAAK,CAACqC,IAAN,CAAW,oBAAX,EAAiC;gBAAEF,KAAK,EAALA,KAAF;gBAASO,QAAQ,EAARA,QAAT;gBAAmBN,QAAQ,EAARA;cAAnB,CAAjC,CADV;;YAAA;cACPE,QADO;cAAA,iBAGiBA,QAAQ,CAACC,IAH1B,EAGLhC,WAHK,kBAGLA,WAHK,EAGQF,IAHR,kBAGQA,IAHR;cAKbQ,UAAU,CAACN,WAAD,CAAV;cAEA2B,QAAQ,CAAC;gBACLX,IAAI,EAAE,UADD;gBACaC,OAAO,EAAE;kBACvBnB,IAAI,EAAJA;gBADuB;cADtB,CAAD,CAAR;;YAPa;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAH;;IAAA,gBAAR0B,QAAQ;MAAA;IAAA;EAAA,GAAd;;EAaA,IAAMD,MAAM,GAAG,SAATA,MAAS,GAAM;IACjBjB,UAAU,CAAC,IAAD,CAAV;IACAqB,QAAQ,CAAC;MAAEX,IAAI,EAAE;IAAR,CAAD,CAAR;EACH,CAHD;;EAIA1B,SAAS,CAAC,YAAM;IACZ;;IACA,2DAAC;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAEaU,WAFb,GAE2BoC,MAAM,CAAC7B,YAAP,CAAoB8B,OAApB,CAA4B,aAA5B,CAF3B;;cAAA,KAIWrC,WAJX;gBAAA;gBAAA;cAAA;;cAMWM,UAAU,CAACN,WAAD,CAAV,CANX,CAOW;cACA;;cARX;cAAA,OASkCP,KAAK,CAACqC,IAAN,CAAW,iDAAX,CATlC;;YAAA;cASiBC,QATjB;cAUmBjC,IAVnB,GAU4BiC,QAAQ,CAACC,IAAT,CAAcA,IAV1C,CAUmBlC,IAVnB;cAWW6B,QAAQ,CAAC;gBACLX,IAAI,EAAE,MADD;gBAELC,OAAO,EAAE;kBACLrB,eAAe,EAAE,IADZ;kBAELE,IAAI,EAAJA;gBAFK;cAFJ,CAAD,CAAR;cAXX;cAAA;;YAAA;cAmBW6B,QAAQ,CAAC;gBACLX,IAAI,EAAE,MADD;gBAELC,OAAO,EAAE;kBACLrB,eAAe,EAAE,KADZ;kBAELE,IAAI,EAAE;gBAFD;cAFJ,CAAD,CAAR;;YAnBX;cAAA;cAAA;;YAAA;cAAA;cAAA;cA4BOmC,OAAO,CAACK,KAAR;cACAX,QAAQ,CAAC;gBACLX,IAAI,EAAE,MADD;gBAELC,OAAO,EAAE;kBACLrB,eAAe,EAAE,KADZ;kBAELE,IAAI,EAAE;gBAFD;cAFJ,CAAD,CAAR;;YA7BP;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAD;EAsCH,CAxCQ,EAwCN,EAxCM,CAAT;;EAyCA,IAAI,CAACgB,KAAK,CAACjB,aAAX,EAA0B;IACtB,oBAAO,QAAC,WAAD;MAAA;MAAA;MAAA;IAAA,SAAP;EACH;;EAAC,oBAAQ,QAAC,WAAD,CAAa,QAAb;IAAsB,KAAK,kCAE1BiB,KAF0B;MAG7BK,MAAM,EAAE,KAHqB;MAI7BC,KAAK,EAALA,KAJ6B;MAK7BG,MAAM,EAANA,MAL6B;MAM7BC,QAAQ,EAARA;IAN6B,EAA3B;IAAA,gBAQNE,QARM;EAAA;IAAA;IAAA;IAAA;EAAA,SAAR;AASL,CAnFM;;GAAMD,Y;;KAAAA,Y;AAoFb,eAAeP,WAAf"},"metadata":{},"sourceType":"module"}